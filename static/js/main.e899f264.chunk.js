(this["webpackJsonpcreative-project-spotify-manager"]=this["webpackJsonpcreative-project-spotify-manager"]||[]).push([[0],[,,,,,function(e,t,a){},function(e,t,a){},function(e,t,a){},,function(e,t,a){e.exports=a(21)},,,,,function(e,t,a){},,function(e,t,a){},function(e,t,a){},function(e,t,a){},function(e,t,a){},function(e,t,a){},function(e,t,a){"use strict";a.r(t);var n=a(0),r=a.n(n),o=a(8),c=a.n(o),s=(a(14),a(1)),i=a.n(s),l=a(3),u=a(2);function m(e,t){window.localStorage.setItem(e,JSON.stringify(t))}function p(e,t){t||(t="");try{return function(e){return JSON.parse(window.localStorage.getItem(e))}(e)}catch(a){return t}}var d="ede2e752aac9420c8255c01272a9d8ca",f="https://bcwebcourse.github.io/creative-project-spotify-manager",h=["playlist-modify-public","user-read-email","user-top-read"];function g(){var e=new URLSearchParams;return e.append("client_id",d),e.append("response_type","token"),e.append("redirect_uri",f),e.append("scope",h.join(" ")),"".concat("https://accounts.spotify.com/authorize","?").concat(e.toString())}function y(e){return new Promise((function(t){return setTimeout(t,e)}))}var v=Object(n.createContext)();var b=function(e){var t=Object(n.useState)(p("accessToken")),a=Object(u.a)(t,2),o=a[0],c=a[1],s=Object(n.useState)(p("exprDate")),d=Object(u.a)(s,2),f=d[0],h=d[1],b=Object(n.useState)(p("userGrantedAccess",!0)),E=Object(u.a)(b,2),w=E[0],j=E[1];function k(){var e=new Date,t=new Date(f);return o&&w&&e<t}function O(){if(new URLSearchParams(window.location.search.substr(1)).get("error"))return j(!1),void m("userGrantedAccess",!1);var e=new URLSearchParams(window.location.hash.substr(1)),t=e.get("access_token");if(t){var a=function(e){var t=new Date,a=1e3*e;return t.setTime(t.getTime()+a),t}(parseInt(e.get("expires_in")));c(t),h(a),j(!0),m("accessToken",t),m("exprDate",a.toString()),m("userGrantedAccess",!0),window.history.replaceState(null,null," ")}}function N(){return(N=Object(l.a)(i.a.mark((function e(){var t;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return m("accessToken",""),m("exprDate",""),m("userGrantedAccess",!1),"https://accounts.spotify.com/en/logout","width=100,height=100,top=0,left=0,toolbar=1,location=1,directories=1,status=1,menubar=1,scrollbars=1",t=window.open("https://accounts.spotify.com/en/logout","Spotify Logout","width=100,height=100,top=0,left=0,toolbar=1,location=1,directories=1,status=1,menubar=1,scrollbars=1"),e.next=8,y(1300);case 8:t.close(),window.location.href=g();case 10:case"end":return e.stop()}}),e)})))).apply(this,arguments)}Object(n.useLayoutEffect)(O,[]);var S={accessToken:o,userGrantedAccess:w,userIsAuthenticated:k,handleAuthRedirect:O,authenticateUser:function(){k()||(O(),window.location.href=g())},logoutUser:function(){return N.apply(this,arguments)}};return r.a.createElement(v.Provider,{value:S},e.children)},E=(a(5),a(6),Object(n.createContext)());var w=function(e){var t=Object(n.useState)("Home"),a=Object(u.a)(t,2),o={page:a[0],setPage:a[1]};return r.a.createElement(E.Provider,{value:o},e.children)},j=Object(n.createContext)();var k=function(e){var t=Object(n.useState)("Home"),a=Object(u.a)(t,2),o={playlist:a[0],setPlaylist:a[1]};return r.a.createElement(j.Provider,{value:o},e.children)},O=function(e){return"/creative-project-spotify-manager"+e};var N=function(e){var t=Object(n.useContext)(E).setPage,a=Object(n.useContext)(j).setPlaylist;return r.a.createElement("div",{className:"playlist-obj"},r.a.createElement("img",{className:"playlist-thumbnail",src:e.playlist.images.length?e.playlist.images[0].url:O("/empty-playlist.png"),alt:"playlist",onClick:function(n){return r=e.playlist.name,t("Playlist/".concat(r)),void a(e.playlist);var r}}),r.a.createElement("p",null,e.playlist.name))};var S=function(e){var t=e.playlists;return r.a.createElement("div",{className:"playlists"},t.map((function(e,t){return r.a.createElement(N,{key:t,playlist:e})})))};var x=function(){var e=Object(n.useState)([]),t=Object(u.a)(e,2),a=t[0],o=t[1],c=Object(n.useContext)(v),s=c.accessToken,m=c.authenticateUser;return Object(n.useEffect)((function(){function e(){return(e=Object(l.a)(i.a.mark((function e(){var t,a,n,r;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=new URLSearchParams({limit:50}),a="https://api.spotify.com/v1/me/playlists?".concat(t),e.next=4,fetch(a,{headers:{Accept:"application/json","Content-Type":"application/json",Authorization:"Bearer ".concat(s)}});case 4:return n=e.sent,e.next=7,n.json();case 7:r=e.sent,o(r.items);case 9:case"end":return e.stop()}}),e)})))).apply(this,arguments)}m(),function(){e.apply(this,arguments)}()}),[s,m]),r.a.createElement("div",{className:"home"},r.a.createElement("header",{className:"home-header"},r.a.createElement("h1",null,"Welcome to Spotify Manager."),r.a.createElement("p",null,'We believe that people deserve to have more control over their music listening experience. That\'s why we created Spotify Manager. Use the navigation bar to checkout your top 50 songs across various timespans, and if you like what you see, click "create playlist" to generate a new playlist of those songs. Then come back here to see that playlist appear below, or open up Spotify to start listening right away.')),r.a.createElement("section",{className:"home-body"},a.length?r.a.createElement("div",null,r.a.createElement("h2",{className:"home-body-header"},"Your Playlists"),r.a.createElement(S,{playlists:a})):r.a.createElement("h2",{className:"loading-indicator"},"Loading...")))};a(16);var T=function(e){var t=e.song.artists.map((function(e){return e.name})).join(", ");return r.a.createElement("div",{className:"song-row"},r.a.createElement("div",{className:"song-ranking"},e.rank,"."),r.a.createElement("div",null,e.song.name),r.a.createElement("div",{className:"song-artist"},t),r.a.createElement("div",{className:"song-popularity"},e.song.popularity," / 100"))};a(17);var C=function(e){var t=e.songs,a=e.isAscending,n=t.map((function(e,t){var n=a?50-t:t+1;return r.a.createElement(T,{key:t,rank:n,song:e})}));return r.a.createElement("div",{className:"top-songs-chart"},r.a.createElement("header",{className:"top-songs-chart-header"},r.a.createElement("div",{className:"song-ranking-placeholder"}),r.a.createElement("div",null,"Title"),r.a.createElement("div",{className:"song-artist"},"Artist"),r.a.createElement("div",{id:"song-popularity",className:"song-popularity"},"Popularity")),n)};function P(){return function(e){var t=e.indexOf(" ")+1;return e.substring(t)}((new Date).toLocaleDateString(void 0,{weekday:"long",year:"numeric",month:"long",day:"numeric"}))}function A(e){return _.apply(this,arguments)}function _(){return(_=Object(l.a)(i.a.mark((function e(t){var a,n,r;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=t.endpoint,n=t.accessToken,e.next=3,fetch(a,{headers:{Accept:"application/json","Content-Type":"application/json",Authorization:"Bearer ".concat(n)}});case 3:return r=e.sent,e.next=6,r.json();case 6:return e.abrupt("return",e.sent);case 7:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function L(e){return U.apply(this,arguments)}function U(){return(U=Object(l.a)(i.a.mark((function e(t){var a,n,r,o;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=t.endpoint,n=t.accessToken,r=t.body,e.next=3,fetch(a,{method:"POST",headers:{Accept:"application/json","Content-Type":"application/json",Authorization:"Bearer ".concat(n)},body:JSON.stringify(r)});case 3:return o=e.sent,e.next=6,o.json();case 6:return e.abrupt("return",e.sent);case 7:case"end":return e.stop()}}),e)})))).apply(this,arguments)}a(7);var M=function(e){var t=e.timeframe,a=e.timeframeReadable,o=Object(n.useState)([]),c=Object(u.a)(o,2),s=c[0],m=c[1],p=Object(n.useState)(!1),d=Object(u.a)(p,2),f=d[0],h=d[1],g=Object(n.useState)(!1),y=Object(u.a)(g,2),b=y[0],E=y[1],w=Object(n.useState)(""),j=Object(u.a)(w,2),k=j[0],O=j[1],N=Object(n.useContext)(v),S=N.accessToken,x=N.authenticateUser;function T(){return"short_term"===t?"Top Songs of the ".concat(a):"medium_term"===t?"Top Songs of the Past ".concat(a):"long_term"===t?"Top Songs of ".concat(a):void 0}function _(e){return e?"ascending":"descending"}function U(e){return M.apply(this,arguments)}function M(){return(M=Object(l.a)(i.a.mark((function e(t){var a,n,r;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return x(),e.next=3,A({endpoint:"https://api.spotify.com/v1/me",accessToken:S});case 3:return a=e.sent,n=f?"50 - 1":"1 - 50",e.next=7,L({endpoint:"https://api.spotify.com/v1/users/".concat(a.id,"/playlists"),accessToken:S,body:{name:T(),description:"This playlist was created for you by Spotify "+"Manager on ".concat(P(),". Ranked in ")+"".concat(_(f)," order from ").concat(n,".")}});case 7:return r=e.sent,O(r.id),e.next=11,L({endpoint:"https://api.spotify.com/v1/playlists/".concat(r.id,"/tracks"),accessToken:S,body:s.map((function(e){return e.uri}))});case 11:e.sent.snapshot_id&&E(!0);case 13:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function R(e){s.length&&(h(!f),m(s.reverse()))}return Object(n.useEffect)((function(){function e(){return(e=Object(l.a)(i.a.mark((function e(){var a,n;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=new URLSearchParams({time_range:t,limit:50}),e.next=3,A({endpoint:"https://api.spotify.com/v1/me/top/tracks?".concat(a),accessToken:S});case 3:n=e.sent,m(n.items);case 5:case"end":return e.stop()}}),e)})))).apply(this,arguments)}x(),m([]),h(!1),E(!1),function(){e.apply(this,arguments)}()}),[x,S,t]),r.a.createElement("div",{className:"top-songs"},b&&r.a.createElement("div",{className:"success-message"},"Success! Go",r.a.createElement("button",{className:"nav-link",onClick:function(){window.location.href="/creative-project-spotify-manager"}},"Home"),"or open",r.a.createElement("button",{className:"nav-link",onClick:function(){window.open("https://open.spotify.com/playlist/".concat(k))}},"Spotify"),"to see your new playlist."),r.a.createElement("header",{className:"top-songs-small-header"},r.a.createElement("div",{className:"top-songs-small-header-buttons"},r.a.createElement("button",{className:"spotify-button top-songs-button small-header-order",onClick:R},"Order ",_(!f)),r.a.createElement("button",{className:"spotify-button top-songs-button",onClick:U},"Create Playlist")),r.a.createElement("h2",{className:"top-songs-title"},T())),r.a.createElement("header",{className:"top-songs-large-header"},r.a.createElement("button",{value:"Descending",className:"spotify-button top-songs-button large-header-order",onClick:R},"Order ",_(!f)),r.a.createElement("h2",{className:"top-songs-title"},T()),r.a.createElement("button",{className:"spotify-button top-songs-button",onClick:U},"Create Playlist")),s.length?r.a.createElement(C,{songs:s,isAscending:f}):r.a.createElement("h2",{className:"loading-indicator"},"Loading..."))};a(18);var R=function(){return r.a.createElement("div",{className:"not-authenticated"},r.a.createElement("h1",null,"Please log in to your Spotify account."),r.a.createElement("p",null,"In order to use this web app, you must log in to your Spotify account and grant all the necessary permissions. If it has been more than an hour since you last logged in, you may be asked to do so again."),r.a.createElement("button",{className:"spotify-button login-button",onClick:function(){window.location.href=g()}},"Log in"))};var I=function(){var e=Object(n.useState)([]),t=Object(u.a)(e,2),a=t[0],o=t[1],c=Object(n.useContext)(j).playlist,s=Object(n.useContext)(v),m=s.accessToken,p=s.authenticateUser,d=Object(n.useState)(!0),f=Object(u.a)(d,2),h=f[0],g=f[1];return Object(n.useEffect)((function(){function e(){return(e=Object(l.a)(i.a.mark((function e(){var t,a,n,r;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=c.tracks.href,e.next=3,fetch(t,{headers:{Accept:"application/json","Content-Type":"application/json",Authorization:"Bearer ".concat(m)}});case 3:return a=e.sent,e.next=6,a.json();case 6:n=e.sent,r=n.items.map((function(e){return e.track})),o(r);case 9:case"end":return e.stop()}}),e)})))).apply(this,arguments)}g(!1),function(){e.apply(this,arguments)}()}),[m,p,c.tracks.href]),r.a.createElement("div",{className:"top-songs"},r.a.createElement("header",{className:"top-songs-small-header"},r.a.createElement("h2",{className:"top-songs-title"},c.name)),r.a.createElement("header",{className:"top-songs-large-header"},r.a.createElement("img",{className:"playlist-thumbnail",src:c.images.length?c.images[0].url:O("/empty-playlist.png"),alt:"playlist"}),r.a.createElement("h2",{className:"top-songs-title"},c.name)),a.length?r.a.createElement(C,{songs:a,isAscending:h}):r.a.createElement("h2",{className:"loading-indicator"},"Loading..."))};var D=function(){var e=Object(n.useContext)(v).userIsAuthenticated,t=Object(n.useContext)(E).page;if(!e())return r.a.createElement(R,null);if(t.startsWith("Playlist"))return r.a.createElement(I,null);switch(t){case"Home":return r.a.createElement(x,null);case"TopSongs-short_term":return r.a.createElement(M,{timeframe:"short_term",timeframeReadable:"Month"});case"TopSongs-medium_term":return r.a.createElement(M,{timeframe:"medium_term",timeframeReadable:"Six Months"});case"TopSongs-long_term":return r.a.createElement(M,{timeframe:"long_term",timeframeReadable:"All Time"});default:return r.a.createElement(x,null)}};a(19);var B=function(){var e=Object(n.useContext)(v).logoutUser,t=Object(n.useContext)(E).setPage;function a(e){["home-button","short-term","medium-term","long-term"].forEach((function(t){t!==e.id&&(document.getElementById(t).style.color="white")}));var t=getComputedStyle(document.body).getPropertyValue("--spotify-green");e.style.color=t}function o(e,n){a(e.target),t("TopSongs-".concat(n))}return Object(n.useLayoutEffect)((function(){a(document.getElementById("home-button"))}),[]),r.a.createElement("nav",null,r.a.createElement("header",{className:"title"},r.a.createElement("img",{className:"logo",src:O("/favicon.ico"),alt:"Logo"}),r.a.createElement("h1",{className:"app-title"},"Spotify Manager")),r.a.createElement("section",{className:"nav-body"},r.a.createElement("button",{id:"home-button",className:"top-songs-nav-item",onClick:function(e){a(e.target),t("Home")}},"Home"),r.a.createElement("h2",{className:"top-songs-nav-item"},"Your Top Songs:"),r.a.createElement("button",{value:"Month",id:"short-term",onClick:function(e){return o(e,"short_term")}},"Month"),r.a.createElement("button",{value:"Six Months",id:"medium-term",onClick:function(e){return o(e,"medium_term")}},"Six Months"),r.a.createElement("button",{value:"All Time",id:"long-term",onClick:function(e){return o(e,"long_term")}},"All Time"),r.a.createElement("button",{className:"top-songs-nav-item",onClick:e},"Logout")))};a(20);var G=function(){return r.a.createElement(b,null,r.a.createElement(w,null,r.a.createElement(k,null,r.a.createElement("div",{className:"main"},r.a.createElement(B,null),r.a.createElement("div",{className:"content"},r.a.createElement(D,null))))))};Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));c.a.render(r.a.createElement(r.a.StrictMode,null,r.a.createElement(G,null)),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(e){e.unregister()})).catch((function(e){console.error(e.message)}))}],[[9,1,2]]]);
//# sourceMappingURL=main.e899f264.chunk.js.map