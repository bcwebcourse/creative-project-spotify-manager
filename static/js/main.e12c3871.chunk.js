(this["webpackJsonpcreative-project-spotify-manager"]=this["webpackJsonpcreative-project-spotify-manager"]||[]).push([[0],[,,,,,,function(e,t,a){e.exports=a(20)},,,,,function(e,t,a){},,function(e,t,a){},function(e,t,a){},function(e,t,a){},function(e,t,a){},function(e,t,a){},function(e,t,a){},function(e,t,a){},function(e,t,a){"use strict";a.r(t);var n=a(0),r=a.n(n),o=a(5),c=a.n(o),s=(a(11),a(1)),i=a(2),l=a.n(i),u=a(3);function p(e,t){window.localStorage.setItem(e,JSON.stringify(t))}function m(e,t){return t||(t=""),a=e,JSON.parse(window.localStorage.getItem(a))||t;var a}var f="ede2e752aac9420c8255c01272a9d8ca",d="http://localhost:3000/",h=["playlist-modify-public","user-read-email","user-top-read"];function g(){var e=new URLSearchParams;return e.append("client_id",f),e.append("response_type","token"),e.append("redirect_uri",d),e.append("scope",h.join(" ")),"".concat("https://accounts.spotify.com/authorize","?").concat(e.toString())}function v(e){return new Promise((function(t){return setTimeout(t,e)}))}var y=Object(n.createContext)();var b=function(e){var t=Object(n.useState)(m("accessToken")),a=Object(s.a)(t,2),o=a[0],c=a[1],i=Object(n.useState)(m("exprDate")),f=Object(s.a)(i,2),d=f[0],h=f[1],b=Object(n.useState)(m("userGrantedAccess",!0)),j=Object(s.a)(b,2),E=j[0],w=j[1];function O(){var e=new Date,t=new Date(d);return o&&E&&e<t}function S(){if(!O()){if(new URLSearchParams(window.location.search.substr(1)).get("error"))return w(!1),void p("userGrantedAccess",!1);var e=new URLSearchParams(window.location.hash.substr(1)),t=e.get("access_token");if(t){parseInt(e.get("expires_in"));var a=function(e){var t=new Date;return t.setTime(t.getTime()+3e4),t}();return c(t),h(a),w(!0),p("accessToken",t),p("exprDate",a.toString()),p("userGrantedAccess",!0),void(window.location.href="/creative-project-spotify-manager")}window.location.href=g()}}function k(){return(k=Object(u.a)(l.a.mark((function e(){var t;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return p("accessToken",""),p("exprDate",""),p("userGrantedAccess",!1),"https://accounts.spotify.com/en/logout","width=100,height=100,top=0,left=0,toolbar=1,location=1,directories=1,status=1,menubar=1,scrollbars=1",t=window.open("https://accounts.spotify.com/en/logout","Spotify Logout","width=100,height=100,top=0,left=0,toolbar=1,location=1,directories=1,status=1,menubar=1,scrollbars=1"),e.next=8,v(1300);case 8:t.close(),window.location.href=g();case 10:case"end":return e.stop()}}),e)})))).apply(this,arguments)}Object(n.useLayoutEffect)(S,[o,d,E]);var x={accessToken:o,userGrantedAccess:E,userIsAuthenticated:O,authenticateUser:S,logoutUser:function(){return k.apply(this,arguments)}};return r.a.createElement(y.Provider,{value:x},e.children)};a(13),a(14);var j=function(e){var t=e.playlist.name.substr(0,25);return console.log(e.playlist.images),t<e.playlist.name&&(t+="..."),r.a.createElement("div",{className:"playlist-obj"},r.a.createElement("button",{className:"btn",onClick:function(t){return a=e.playlist.name,void e.setPage(a);var a}},r.a.createElement("img",{src:e.playlist.images[0].url,alt:"playlist"})),r.a.createElement("body",null,t))};var E=function(){var e=Object(n.useState)(""),t=Object(s.a)(e,2),a=t[0],o=t[1],c=Object(n.useState)([]),i=Object(s.a)(c,2),p=i[0],m=i[1],f=Object(n.useContext)(y).accessToken;return Object(n.useLayoutEffect)((function(){function e(){return(e=Object(u.a)(l.a.mark((function e(){var t,a;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return"https://api.spotify.com/v1/me/playlists?",e.next=3,fetch("https://api.spotify.com/v1/me/playlists?",{headers:{Accept:"application/json","Content-Type":"application/json",Authorization:"Bearer ".concat(f)}});case 3:return t=e.sent,e.next=6,t.json();case 6:a=e.sent,m(a.items);case 8:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function t(){return(t=Object(u.a)(l.a.mark((function e(){var t,a;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,fetch("https://api.spotify.com/v1/me",{headers:{Accept:"application/json","Content-Type":"application/json",Authorization:"Bearer ".concat(f)}});case 2:return t=e.sent,e.next=5,t.json();case 5:a=e.sent,o(a);case 7:case"end":return e.stop()}}),e)})))).apply(this,arguments)}!function(){t.apply(this,arguments)}(),function(){e.apply(this,arguments)}()}),[f]),console.log(p),r.a.createElement("div",null,r.a.createElement("h3",null,"User Data"),r.a.createElement("div",{className:"user-name"},"Name: ",a.display_name),r.a.createElement("div",{className:"user-email"},"Email: ",a.email),r.a.createElement("div",{className:"playlists"},p.map((function(e,t){return r.a.createElement(j,{key:t,playlist:e})}))))};a(15);var w=function(e){var t=e.song.name.substr(0,40);t<e.song.name&&(t+="...");var a=e.song.artists.map((function(e){return e.name})).join(", ");return r.a.createElement("div",{className:"song-row"},r.a.createElement("div",{className:"song-ranking"},e.rank,"."),r.a.createElement("div",null,t),r.a.createElement("div",null,a),r.a.createElement("div",{className:"song-popularity"},e.song.popularity))},O=Object(n.createContext)();var S=function(e){var t=Object(n.useState)("Home"),a=Object(s.a)(t,2),o=a[0],c=a[1],i=Object(n.useState)("Month"),l=Object(s.a)(i,2),u={timeframe:o,setTimeframe:c,timeframeReadable:l[0],setTimeframeReadable:l[1]};return r.a.createElement(O.Provider,{value:u},e.children)};a(16);var k=function(){var e=Object(n.useState)([]),t=Object(s.a)(e,2),a=t[0],o=t[1],c=Object(n.useState)(!1),i=Object(s.a)(c,2),p=i[0],m=i[1],f=Object(n.useContext)(y).accessToken,d=Object(n.useContext)(O),h=d.timeframe,g=d.timeframeReadable;function v(){return(v=Object(u.a)(l.a.mark((function e(t){var n,r,o,c,s,i,u,p,d,h,v,y,b,j,E;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,fetch("https://api.spotify.com/v1/me",{headers:{Accept:"application/json","Content-Type":"application/json",Authorization:"Bearer ".concat(f)}});case 2:return n=e.sent,e.next=5,n.json();case 5:return r=e.sent,o=new Date,c={weekday:"long",year:"numeric",month:"long",day:"numeric"},s={hour:"2-digit",minute:"2-digit"},i=o.toLocaleDateString(void 0,c),u=o.toLocaleTimeString([],s),p="https://api.spotify.com/v1/users/".concat(r.id,"/playlists"),e.next=14,fetch(p,{method:"POST",headers:{Accept:"application/json","Content-Type":"application/json",Authorization:"Bearer ".concat(f)},body:JSON.stringify({name:"Top Songs of the Past ".concat(g),description:"This playlist was created for you by Spotify Manager on ".concat(i," at ").concat(u,".")})});case 14:return d=e.sent,e.next=17,d.json();case 17:return h=e.sent,v=h.id,y=a.map((function(e){return e.uri})),b="https://api.spotify.com/v1/playlists/".concat(v,"/tracks"),e.next=23,fetch(b,{method:"POST",headers:{Accept:"application/json","Content-Type":"application/json",Authorization:"Bearer ".concat(f)},body:JSON.stringify(y)});case 23:return j=e.sent,e.next=26,j.json();case 26:E=e.sent,console.log(E),E.snapshot_id&&m(!0);case 29:case"end":return e.stop()}}),e)})))).apply(this,arguments)}return Object(n.useLayoutEffect)((function(){function e(){return(e=Object(u.a)(l.a.mark((function e(){var t,a,n,r;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=new URLSearchParams({time_range:h,limit:50}),a="https://api.spotify.com/v1/me/top/tracks?"+t,e.next=4,fetch(a,{headers:{Accept:"application/json","Content-Type":"application/json",Authorization:"Bearer ".concat(f)}});case 4:return n=e.sent,e.next=7,n.json();case 7:r=e.sent,o(r.items);case 9:case"end":return e.stop()}}),e)})))).apply(this,arguments)}!function(){e.apply(this,arguments)}()}),[f,h]),r.a.createElement("div",{className:"top-songs"},p&&r.a.createElement("div",{className:"success-message"},"Success! Open Spotify to see your new playlist."),r.a.createElement("header",{className:"top-songs-header"},r.a.createElement("button",{className:"top-songs-button"},"Filter Button"),r.a.createElement("h2",{className:"top-songs-title"},"Top Songs of the Past ",g),r.a.createElement("button",{className:"top-songs-button",onClick:function(e){return v.apply(this,arguments)}},"Create Playlist")),r.a.createElement("header",{className:"top-songs-charts-header"},r.a.createElement("div",{className:"song-ranking-placeholder"}),r.a.createElement("div",null,"Title"),r.a.createElement("div",{className:"song-artist"},"Artist"),r.a.createElement("div",{className:"song-popularity"},"Popularity / 100")),a.map((function(e,t){return r.a.createElement(w,{key:t,rank:t+1,song:e})})))};a(17);var x=function(e){return r.a.createElement("div",null,r.a.createElement("h1",null,"Please log in to your Spotify account."),r.a.createElement("p",null,"In order to use this web app, you must log in to your Spotify account and grant all the necessary permissions. If it has been more than an hour since you last logged in, you may be asked to do so again."),r.a.createElement("button",{onClick:function(e){window.location.href=g()}},"Log in"))};var N=function(e){if(!Object(n.useContext)(y).userGrantedAccess)return r.a.createElement(x,null);switch(e.page){case"Home":return r.a.createElement(E,null);case"TopSongs":return r.a.createElement(k,null);default:return r.a.createElement(E,null)}};a(18);var T=function(e){var t,a=Object(n.useContext)(O),o=a.setTimeframe,c=a.setTimeframeReadable,s=Object(n.useContext)(y).logoutUser;function i(t,a){o(a),c(t.target.innerHTML),e.setPage("TopSongs")}return r.a.createElement("nav",null,r.a.createElement("div",{className:"title"},r.a.createElement("img",{className:"logo",src:(t="/favicon.ico","/creative-project-spotify-manager"+t),alt:"Logo"}),r.a.createElement("h1",{className:"app-title"},"Spotify Manager")),r.a.createElement("button",{className:"top-songs-nav-item",onClick:function(){return e.setPage("Home")}},"Home"),r.a.createElement("h2",{className:"top-songs-nav-item"},"Your Top Songs of the Past:"),r.a.createElement("button",{onClick:function(e){return i(e,"short_term")}},"Month"),r.a.createElement("button",{onClick:function(e){return i(e,"medium_term")}},"Six Months"),r.a.createElement("button",{onClick:function(e){return i(e,"long_term")}},"Few Years"),r.a.createElement("button",{className:"top-songs-nav-item",onClick:s},"Logout"))};a(19);var C=function(){var e=Object(n.useState)("Home"),t=Object(s.a)(e,2),a=t[0],o=t[1];return r.a.createElement(b,null,r.a.createElement(S,null,r.a.createElement("div",{className:"main"},r.a.createElement(T,{setPage:o}),r.a.createElement("div",{className:"content"},r.a.createElement(N,{page:a})))))};Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));c.a.render(r.a.createElement(r.a.StrictMode,null,r.a.createElement(C,null)),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(e){e.unregister()})).catch((function(e){console.error(e.message)}))}],[[6,1,2]]]);
//# sourceMappingURL=main.e12c3871.chunk.js.map